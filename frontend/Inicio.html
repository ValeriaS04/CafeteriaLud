<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cafeter√≠a JAVA</title>
  <link rel="stylesheet" href="estilosi.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
  <!-- Encabezado -->
  <header>
    <h1><i class="fa-solid fa-mug-saucer" style="color: #ffffff;"></i> Cafeter√≠a JAVA</h1>
    <nav>
      <a href="#" class="activo">Inicio</a>
      <a href="Gestion de pedidos.html">Pedidos</a>
      <a href="Inventario/inventario_menu.html">Inventario</a>
      <a href="Panel.html">Panel</a>
      <a href="Usuarios.html" id="linkUsuarios" style="display:none;">Usuarios</a>
      <a href="InicioSesion.html">Cerrar sesion</a>
    </nav>
  </header>

  <!-- Contenido principal -->
  <main>
    <section class="hero">
      <div>
        <h1>Bienvenidos a Cafeter√≠a JAVA</h1>
        <p>Disfruta de nuestras bebidas y postres artesanales en un ambiente acogedor y moderno. Cada visita es una
          experiencia √∫nica.</p>
      </div>
    </section>
  </main>

  <!-- Pie de p√°gina -->
  <footer>
    <div class="contacto">
      <h3>Cont√°ctanos</h3>
      <p>Tel√©fono: +52 867 789 2930</p>
      <p>Correo: <a href="mailto:contacto@cafeteria.com">cafeteriajav4@gmail.com</a></p>
    </div>

    <div class="social">
      <h3>S√≠guenos</h3>
      <div class="icons">
        <a href="#" title="Twitter">
          <img src="https://cdn-icons-png.flaticon.com/512/5969/5969020.png" alt="Twitter" width="24" height="24">
        </a>
        <a href="#" title="Facebook">
          <img src="https://cdn-icons-png.flaticon.com/512/5968/5968764.png" alt="Facebook" width="24" height="24">
        </a>
        <a href="#" title="Instagram">
          <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram" width="24" height="24">
        </a>
      </div>
    </div>
  </footer>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
        // 1. Controlar link de Usuarios
        const rol = localStorage.getItem("usuarioRol");
        if (rol === "Administrador") {
            document.getElementById("linkUsuarios").style.display = "inline-block";
        }

        // 2. Verificar alerta de stock SOLO si viene del login
        if (localStorage.getItem('mostrarAlertaStock') === 'true') {
            verificarStockBajoAlInicio();
            // Limpiar la bandera inmediatamente
            localStorage.removeItem('mostrarAlertaStock');
        }
    });

    async function verificarStockBajoAlInicio() {
        try {
            const userRole = localStorage.getItem('usuarioRol');
            // Solo verificar para Admin y Encargado de Inventario
            if (userRole !== 'Administrador' && userRole !== 'Encargado de inventario') {
                return;
            }

            const response = await fetch('http://localhost:3000/api/inventario/vistas/stock-critico');
            if (!response.ok) return;
            
            const stockBajo = await response.json();
            if (stockBajo.length > 0) {
                mostrarAlertaStockBajo(stockBajo);
            }
        } catch (error) {
            console.error('Error al verificar stock bajo:', error);
        }
    }

    function mostrarAlertaStockBajo(stockBajo) {
        const productosCriticos = stockBajo.filter(p => p.Estado === 'CR√çTICO');
        const productosBajos = stockBajo.filter(p => p.Estado === 'BAJO');
        
        let mensaje = 'üö® ATENCI√ìN - STOCK BAJO\n\n';
        
        if (productosCriticos.length > 0) {
            mensaje += 'üî¥ PRODUCTOS CR√çTICOS:\n';
            productosCriticos.forEach(p => {
                mensaje += `‚Ä¢ ${p.Nombre}: ${p.Cantidad} unidades\n`;
            });
            mensaje += '\n';
        }
        
        if (productosBajos.length > 0) {
            mensaje += 'üü° PRODUCTOS BAJOS:\n';
            productosBajos.forEach(p => {
                mensaje += `‚Ä¢ ${p.Nombre}: ${p.Cantidad} unidades\n`;
            });
        }
        
        // Agregar mensaje final
        mensaje += '\n‚ö†Ô∏è Por favor, revisa el inventario y genera las √≥rdenes necesarias.';
        
        alert(mensaje);
    }
</script>
</body>

</html>